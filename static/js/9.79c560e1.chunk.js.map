{"version":3,"sources":["utils/axios-keycloak.js","utils/api-real.js"],"names":["AxiosKeycloak","config","instance","axios","create","interceptors","request","use","Promise","resolve","reject","updateToken","success","headers","Authorization","token","error","login","response","data","cause","Keycloak","keycloak","url","env","realm","clientId","apiHttpClient","createAxiosInstance","baseURL","responseType","responseEncoding","withCredentials","api","auth","console","log","init","onLoad","authenticated","Error","isAuthenticated","logout","getUser","loadUserInfo","userInfo","firstName","given_name","lastName","family_name","email","isDeposant","hasRealmRole","isInstructeur","isBeta","depots","mesDepots","get","then","res","monDepot","id","ajouterDepot","formData","post","catch","JSON","stringify","supprimerDepot","delete","savePieceJointe","dossierId","numero","lireFichier","fichierId","content_disposition","content_type","matches","exec","fileInfo","URL","createObjectURL","Blob","type","nom","extractFileInfo"],"mappings":"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","file":"static/js/9.79c560e1.chunk.js","sourcesContent":["import axios from 'axios';\nimport Keycloak from 'keycloak-js';\n\nexport default class AxiosKeycloak extends Keycloak {\n  createAxiosInstance(config) {\n    const instance = axios.create(config);\n\n    instance.interceptors.request.use(\n      config =>\n        new Promise((resolve, reject) =>\n          this.updateToken(5)\n            .success(() => {\n              config.headers.Authorization = 'Bearer ' + this.token;\n              resolve(config);\n            })\n            .error(() => {\n              this.login();\n            })\n        )\n    );\n    instance.interceptors.response.use(\n      function(response) {\n        return response;\n      },\n      function(error) {\n        if (error.response) {\n          if (error.response.data.cause) {\n            return Promise.reject(error.response.data.cause);\n          } else {\n            return Promise.reject(error.response.data);\n          }\n        } else if (error.request) {\n          return Promise.reject(error.request);\n        } else {\n          return Promise.reject(error);\n        }\n      }\n    );\n\n    return instance;\n  }\n\n  static get axios() {\n    return axios;\n  }\n}\n","import AxiosKeycloak from 'utils/axios-keycloak';\nimport { env } from 'utils/env-helper';\n\n// API réelle\n\nconst keycloak = new AxiosKeycloak({\n  url: env('REACT_APP_SSO_APP_URL'),\n  realm: env('REACT_APP_SSO_APP_REALM'),\n  clientId: env('REACT_APP_SSO_APP_CLIENT_ID')\n});\n\nconst apiHttpClient = keycloak.createAxiosInstance({\n  baseURL: env('REACT_APP_API_URL'),\n  responseType: 'json',\n  responseEncoding: 'utf8',\n  headers: { 'Content-Type': 'application/json;charset=UTF-8' },\n  withCredentials: true\n});\n\nfunction login() {\n  return new Promise((resolve, reject) => {\n    console.log('login');\n    return keycloak\n      .init({ onLoad: 'login-required' })\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction logout() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .logout()\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction isAuthenticated() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction isDeposant() {\n  return new Promise((resolve, reject) => {\n    return resolve(keycloak.hasRealmRole('DEPOSANT'));\n  });\n}\n\nfunction isInstructeur() {\n  return new Promise((resolve, reject) => {\n    return resolve(keycloak.hasRealmRole('INSTRUCTEUR'));\n  });\n}\n\nfunction isBeta() {\n  return new Promise((resolve, reject) => {\n    return resolve(keycloak.hasRealmRole('BETA'));\n  });\n}\n\nfunction getUser() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .loadUserInfo()\n      .success(userInfo => {\n        return resolve({\n          firstName: userInfo.given_name,\n          lastName: userInfo.family_name,\n          email: userInfo.email\n        });\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction mesDepots() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(apiHttpClient.get(`/dossiers`).then(res => res.data));\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction monDepot(id) {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(\n          apiHttpClient.get(`/dossiers/${id}`).then(res => res.data)\n        );\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction supprimerDepot(id) {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(\n          apiHttpClient.delete(`/dossiers/${id}`).then(res => res.data)\n        );\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction ajouterDepot(formData) {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        apiHttpClient\n          .post(`/dossiers`, formData, {\n            headers: {\n              'content-type':\n                'multipart/form-data;boundary=gc0p4Jq0M2Yt08jU534c0p'\n            }\n          })\n          .then(function(response) {\n            return resolve(response);\n          })\n          .catch(function(error) {\n            console.log('error=', JSON.stringify(error));\n            return reject(error);\n          });\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction savePieceJointe(dossierId, numero, formData) {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(\n          apiHttpClient\n            .post(`/dossiers/${dossierId}/piecesjointes/${numero}`, formData, {\n              headers: {\n                'content-type':\n                  'multipart/form-data;boundary=gc0p4Jq0M2Yt08jU534c0p'\n              }\n            })\n            .catch(function(error) {\n              console.log('error=', JSON.stringify(error));\n              return reject(error);\n            })\n        );\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nfunction extractFileInfo(response) {\n  let regex_filename = /^attachment;filename=([\\w- éèëàù€êôïî]+[.]{1}[\\w]+)$/i;\n  let content_disposition = response.headers['content-disposition'];\n  let content_type = response.headers['content-type'];\n  let matches = regex_filename.exec(content_disposition);\n  let fileInfo = {\n    data: URL.createObjectURL(\n      new Blob([response.data], { type: content_type })\n    ),\n    nom: matches[1],\n    type: content_type\n  };\n  console.log('fileInfo=', fileInfo);\n  return fileInfo;\n}\n\nfunction lireFichier(fichierId) {\n  console.log('fichierId=', fichierId);\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(\n          apiHttpClient\n            .get(`/fichiers/${fichierId}`, { responseType: 'blob' })\n            .then(response => extractFileInfo(response))\n            .catch(function(error) {\n              console.log('error=', JSON.stringify(error));\n              return reject(error);\n            })\n        );\n      })\n      .error(error => {\n        return reject(new Error(error));\n      });\n  });\n}\n\nconst auth = {\n  login,\n  isAuthenticated,\n  logout,\n  getUser,\n  isDeposant,\n  isInstructeur,\n  isBeta\n};\nconst depots = {\n  mesDepots,\n  monDepot,\n  ajouterDepot,\n  supprimerDepot,\n  savePieceJointe,\n  lireFichier\n};\n\nconst api = {\n  auth,\n  depots\n};\n\nexport default api;\n"],"sourceRoot":""}